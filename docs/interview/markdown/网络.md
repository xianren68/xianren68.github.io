# 网络

## websocket的心跳机制是什么？

> websocket心跳机制（保活机制） 是一种用于保持websocket连接活跃的策略
>
> 在websocket连接中，心跳机制通过定时发送小的，无害的控制消息（通常称做心跳）来确保连接在长时间内保持打开状态，同时检测连接是否仍然有效

### 心跳机制的目的

#### 1. 保持连接活跃

> 在某些网络环境中，例如企业网络或防火墙，长时间的非活跃连接会被关闭（如负载均衡器或代理服务器)，定时发送心跳可以防止这种情况的发生

#### 2. 检测连接断开

> 心跳机制可以用于检测服务器或客户端连接是否仍然有效，如果一方没有接收心跳包，另一方可以认为连接已经断开，以便执行相应的措施(如断线重连）

#### 3. 维持代理服务器的连接

> 在通过代理服务器进行websocket连接时，代理服务器可能会关闭长时间未活动的连接，心跳消息可以确保连接在代理服务器上的活跃

### 需要注意的点

#### 1. 心跳间隔

> 心跳消息的发送间隔应该根据需求以及网络环境来决定，如果间隔太短，则会导致不必要的网络流量，而时间太长则会导致无法即使检测到连接的问题

#### 2. 心跳消息的内容

> 心跳消息通常是轻量级的，可以是一个空的websocket帧，或者一个特定格式的心跳消息，重要的是心跳消息不能影响应用程序的正常执行

#### 3. 心跳消息的发送与接收

> 在websocket连接成功后，服务端与客户端都应该定时发送心跳消息，并监听对方的心跳响应

#### 4. 处理未响应的心跳

> 如果一方没有响应心跳，那么就应当认为连接已经断开，并采取相应的措施，例如断线重连或通知用户


## 跨域

### 1. 为什么会产生跨域问题？

> 跨域问题是因为浏览器同源策略(Same-Origin policy) 而产生的，同源策略指请求的域名，端口，以及协议必须与提供资源的网站相同，当一个网页试图访问一个其他来源（不同域名、端口、协议）的数据时，浏览器就会阻止请求的接收或发送，从而引发跨域问题

### 2. 如何解决跨域问题

#### 1. cors (Cross-Origin Resource Sharing )

> 通过在服务端设置特定的http响应头，允许特定的外部域访问资源

```json
// 允许127.0.0.1访问
Access-Control-Allow-Origin : 127.0.0.1
```
#### 2. jsonp (JSON with padding)

> 利于`script`标签可以跨域获取脚本的特性，通过动态的创建标签并设置其`src`属性来获取数据

#### 3. 代理服务器

> 在服务端设置代理，通过代理服务器将请求转发给目标服务器，从而绕过同源策略的限制

#### 4. websocket连接

> 使用websocket协议来获取数据

### 3. 代理服务器的原理是什么？

> 浏览器的请求和服务端的响应都通过代理服务器转发，浏览器不用理会目标服务器的跨域问题，只要和代理服务器没有跨域问题即可
